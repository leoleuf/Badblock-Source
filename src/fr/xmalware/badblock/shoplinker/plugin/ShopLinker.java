package fr.xmalware.badblock.shoplinker.plugin;

import org.bukkit.Bukkit;
import org.bukkit.command.ConsoleCommandSender;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.plugin.java.JavaPlugin;

import fr.badblock.rabbitconnector.RabbitConnector;
import fr.xmalware.badblock.shoplinker.api.ShopLinkerAPI;
import fr.xmalware.badblock.shoplinker.plugin.database.BadblockDatabase;
import fr.xmalware.badblock.shoplinker.plugin.listeners.ReceiveShopDataListener;
import lombok.Getter;

public class ShopLinker extends JavaPlugin {

	@Getter private static ConsoleCommandSender console;
	@Getter private static String			 	message;
	
	@Override
	public void onEnable() {
		this.reloadConfig();
		console = Bukkit.getConsoleSender();
		FileConfiguration configuration = this.getConfig();
		RabbitConnector.getInstance().newService("default", configuration.getString("rabbit.hostname"), configuration.getInt("rabbit.port"), configuration.getString("rabbit.username"), configuration.getString("rabbit.password"), configuration.getString("rabbit.virtualhost"));
		BadblockDatabase.getInstance().connect(configuration.getString("db.host"), configuration.getInt("db.port"), configuration.getString("db.user"), configuration.getString("db.pass"), configuration.getString("db.db"));
		ShopLinkerAPI.CURRENT_SERVER_NAME = configuration.getString("queueName");
		try {
			new ReceiveShopDataListener(configuration.getString("queueName"));
		} catch (Exception e) {
			e.printStackTrace();
		}
		message = configuration.getString("boughtMessage", "%0 %1");
	}
	
}
